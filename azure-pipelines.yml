trigger:
  branches:
    include:
      - main

variables:
- group: terraform-backend

pool:
  name: Default

steps:
- checkout: self

- script: terraform --version
  displayName: 'VerificÄƒ versiunea Terraform'

- script: |
    set ARM_CLIENT_ID=%appId%
    set ARM_CLIENT_SECRET=%password%
    set ARM_TENANT_ID=%tenant%
    set ARM_SUBSCRIPTION_ID=%subscriptionId%

    terraform init -reconfigure
    terraform plan -out=tfplan
  workingDirectory: terraform-azure
  displayName: 'Terraform Init & Plan'

- script: terraform apply -auto-approve tfplan
  workingDirectory: terraform-azure
  displayName: 'Terraform Apply'